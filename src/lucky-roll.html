<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>LuckyRoll - ËØæÂ†ÇÁÇπÂêçÁ≥ªÁªü</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&family=Noto+Sans+SC:wght@500;700;900&display=swap" rel="stylesheet">
    
    <!-- Babel for JSX compilation in browser -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Tailwind Config -->
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              'festive': ['"Ma Shan Zheng"', 'cursive'],
              'sans': ['"Noto Sans SC"', 'sans-serif'],
            },
            colors: {
              'china-red': '#D7000F',
              'gold-main': '#FCC200',
              'gold-dark': '#E6AC00',
            },
            animation: {
              'bounce-slight': 'bounce-slight 0.5s infinite',
              'wiggle': 'wiggle 1s ease-in-out infinite',
            },
            keyframes: {
              'bounce-slight': {
                '0%, 100%': { transform: 'translateY(-2%)' },
                '50%': { transform: 'translateY(0)' },
              },
              'wiggle': {
                '0%, 100%': { transform: 'rotate(-3deg)' },
                '50%': { transform: 'rotate(3deg)' },
              }
            }
          },
        },
      }
    </script>
    
    <style>
      body {
        background-color: #C82E26;
        overflow: hidden; 
      }
      ::-webkit-scrollbar { width: 8px; }
      ::-webkit-scrollbar-track { background: #5e0000; }
      ::-webkit-scrollbar-thumb { background: #FCC200; border-radius: 4px; }
      
      /* Hide file input */
      .hidden-input { display: none; }
    </style>

    <!-- Import Map for Modules -->
    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
        "lucide-react": "https://esm.sh/lucide-react@0.292.0",
        "xlsx": "https://esm.sh/xlsx@0.18.5",
        "canvas-confetti": "https://esm.sh/canvas-confetti@1.9.2"
      }
    }
    </script>
  </head>
  <body>
    <div id="root"></div>

    <!-- MAIN APPLICATION CODE -->
    <script type="text/babel" data-type="module" data-presets="typescript,react">
      import React, { useState, useEffect, useCallback, useRef } from 'react';
      import { createRoot } from 'react-dom/client';
      import { Play, ArrowLeft, Settings2, Target, X, Upload, CheckSquare, Square, Trash2, Users } from 'lucide-react';
      import { read, utils } from 'xlsx';
      import confetti from 'canvas-confetti';

      // --- 1. TYPES ---
      interface Student {
        id: string;
        name: string;
        active: boolean;
      }

      enum AppState {
        IDLE = 'IDLE',
        ROLLING = 'ROLLING',
        SELECTED = 'SELECTED',
      }

      // --- 2. UTILS ---
      const parseExcelFile = async (file: File): Promise<Student[]> => {
        return new Promise((resolve, reject) => {
          const reader = new FileReader();
          reader.onload = (e) => {
            try {
              const data = e.target?.result;
              const workbook = read(data, { type: 'binary' });
              const sheetName = workbook.SheetNames[0];
              const sheet = workbook.Sheets[sheetName];
              const jsonData = utils.sheet_to_json(sheet, { header: 1 }) as any[][];
              
              const students: Student[] = [];
              jsonData.forEach((row) => {
                if (row[0] && typeof row[0] === 'string') {
                  students.push({
                    id: crypto.randomUUID(),
                    name: row[0].trim(),
                    active: true
                  });
                }
              });
              resolve(students);
            } catch (error) {
              reject(error);
            }
          };
          reader.onerror = (error) => reject(error);
          reader.readAsBinaryString(file);
        });
      };

      // --- 3. COMPONENTS: CHARACTERS ---
      const TangSeng = ({ className }) => (
        <svg viewBox="0 0 200 220" className={className} xmlns="http://www.w3.org/2000/svg">
          <defs>
            <linearGradient id="skin-gradient" x1="0%" y1="0%" x2="0%" y2="100%">
              <stop offset="0%" stopColor="#FFF0E0" />
              <stop offset="100%" stopColor="#FFE0BD" />
            </linearGradient>
            <linearGradient id="robe-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" stopColor="#E31837" />
              <stop offset="100%" stopColor="#B91C1C" />
            </linearGradient>
          </defs>
          <g transform="translate(0, 10)">
              <path d="M40 140 Q 30 220 20 220 L 180 220 Q 170 220 160 140 Z" fill="url(#robe-gradient)" stroke="#8B0000" strokeWidth="2" />
              <path d="M60 140 L 100 220 L 140 140 Z" fill="#F59E0B" />
              <path d="M100 140 L 100 220" stroke="#B45309" strokeWidth="1" />
              <path d="M40 140 Q 60 220 90 220 L 40 220 Z" fill="#FCD34D" stroke="#B45309" strokeWidth="1.5" />
              <path d="M160 140 Q 140 220 110 220 L 160 220 Z" fill="#FCD34D" stroke="#B45309" strokeWidth="1.5" />
              <path d="M50 160 L 80 160" stroke="#B45309" strokeWidth="1" opacity="0.6"/>
              <path d="M45 190 L 85 190" stroke="#B45309" strokeWidth="1" opacity="0.6"/>
              <path d="M150 160 L 120 160" stroke="#B45309" strokeWidth="1" opacity="0.6"/>
              <path d="M155 190 L 115 190" stroke="#B45309" strokeWidth="1" opacity="0.6"/>
          </g>
          <g transform="translate(0, 5)">
              <ellipse cx="50" cy="95" rx="12" ry="16" fill="#FFE0BD" />
              <ellipse cx="150" cy="95" rx="12" ry="16" fill="#FFE0BD" />
              <rect x="58" y="60" width="84" height="75" rx="40" ry="40" fill="url(#skin-gradient)" stroke="#E6C0A0" strokeWidth="2" />
              <path d="M85 110 Q 100 120 115 110" fill="none" stroke="#5A3A29" strokeWidth="3" strokeLinecap="round" />
              <circle cx="70" cy="102" r="7" fill="#FFB6C1" opacity="0.5" />
              <circle cx="130" cy="102" r="7" fill="#FFB6C1" opacity="0.5" />
              <ellipse cx="80" cy="90" rx="6" ry="8" fill="#2D1810" />
              <circle cx="82" cy="88" r="2" fill="white" />
              <ellipse cx="120" cy="90" rx="6" ry="8" fill="#2D1810" />
              <circle cx="122" cy="88" r="2" fill="white" />
              <circle cx="100" cy="75" r="3" fill="#DC2626" />
          </g>
          <g transform="translate(0, -5)">
              <path d="M40 60 L 40 20 Q 75 -5 100 15 Q 125 -5 160 20 L 160 60 Z" fill="#DC2626" stroke="#F59E0B" strokeWidth="2" />
              <path d="M50 60 Q 100 80 150 60 L 150 40 Q 100 55 50 40 Z" fill="#FCD34D" stroke="#B45309" strokeWidth="1.5" />
              <g transform="translate(0, 5)">
                  <path d="M65 40 L 65 15 Q 72 5 80 15 L 80 40" fill="#FCD34D" stroke="#B45309" strokeWidth="1" />
                  <circle cx="72.5" cy="15" r="4" fill="#FFFFFF" />
                  <path d="M92 40 L 92 10 Q 100 0 108 10 L 108 40" fill="#FCD34D" stroke="#B45309" strokeWidth="1" />
                  <circle cx="100" cy="10" r="5" fill="#FFFFFF" />
                  <path d="M120 40 L 120 15 Q 128 5 135 15 L 135 40" fill="#FCD34D" stroke="#B45309" strokeWidth="1" />
                  <circle cx="127.5" cy="15" r="4" fill="#FFFFFF" />
              </g>
          </g>
          <g transform="translate(0, 15)">
              <path d="M85 140 Q 100 120 115 140 L 115 160 L 85 160 Z" fill="#FFE0BD" stroke="#E6C0A0" strokeWidth="1" />
              <path d="M100 130 L 100 160" stroke="#E6C0A0" strokeWidth="1" />
          </g>
        </svg>
      );

      const SunWukong = ({ className }) => (
        <svg viewBox="0 0 200 220" className={className} xmlns="http://www.w3.org/2000/svg">
           <path d="M60 150 Q 50 220 40 220 L 160 220 Q 150 220 140 150 Z" fill="#F59E0B" stroke="#B45309" strokeWidth="2" />
           <path d="M70 150 Q 100 180 130 150 L 115 180 L 85 180 Z" fill="#DC2626" />
           <path d="M60 80 Q 50 50 100 40 Q 150 50 140 80 Q 150 110 120 130 Q 100 140 80 130 Q 50 110 60 80" fill="#92400E" stroke="#78350F" strokeWidth="2" />
           <path d="M70 75 Q 70 55 90 65 Q 100 70 110 65 Q 130 55 130 75 Q 135 95 120 110 Q 100 125 80 110 Q 65 95 70 75" fill="#FFE4C4" />
           <ellipse cx="85" cy="85" rx="6" ry="8" fill="white" />
           <circle cx="85" cy="85" r="3" fill="black" />
           <ellipse cx="115" cy="85" rx="6" ry="8" fill="white" />
           <circle cx="115" cy="85" r="3" fill="black" />
           <path d="M90 105 Q 100 110 110 105" fill="none" stroke="#5A3A29" strokeWidth="2" />
           <path d="M65 60 Q 100 45 135 60" fill="none" stroke="#FCD34D" strokeWidth="6" strokeLinecap="round" />
           <circle cx="100" cy="52" r="6" fill="#FCD34D" stroke="#B45309" strokeWidth="1" />
           <circle cx="50" cy="180" r="15" fill="#FFE4C4" stroke="#D97706" strokeWidth="1" />
           <circle cx="150" cy="180" r="15" fill="#FFE4C4" stroke="#D97706" strokeWidth="1" />
        </svg>
      );

      const ZhuBajie = ({ className }) => (
        <svg viewBox="0 0 200 220" className={className} xmlns="http://www.w3.org/2000/svg">
          <path d="M30 70 Q 10 50 20 90 Q 30 130 50 110" fill="#FECDD3" stroke="#F43F5E" strokeWidth="2" />
          <path d="M170 70 Q 190 50 180 90 Q 170 130 150 110" fill="#FECDD3" stroke="#F43F5E" strokeWidth="2" />
          <path d="M50 150 Q 30 220 20 220 L 180 220 Q 170 220 150 150 Z" fill="#1F2937" stroke="#000" strokeWidth="2" />
          <ellipse cx="100" cy="220" rx="40" ry="30" fill="#000" opacity="0.3" />
          <circle cx="100" cy="100" r="50" fill="#FFE4E6" stroke="#F43F5E" strokeWidth="2" />
          <path d="M65 65 L 135 65 L 125 35 L 75 35 Z" fill="#1F2937" stroke="#000" strokeWidth="2" />
          <rect x="70" y="35" width="60" height="5" fill="#374151" />
          <ellipse cx="100" cy="110" rx="18" ry="14" fill="#FDA4AF" stroke="#BE123C" strokeWidth="2" />
          <circle cx="94" cy="110" r="3.5" fill="#BE123C" />
          <circle cx="106" cy="110" r="3.5" fill="#BE123C" />
          <path d="M80 85 Q 88 80 96 85" fill="none" stroke="#000" strokeWidth="2" />
          <path d="M104 85 Q 112 80 120 85" fill="none" stroke="#000" strokeWidth="2" />
          <path d="M90 135 Q 100 140 110 135" fill="none" stroke="#BE123C" strokeWidth="2" />
        </svg>
      );

      // --- 4. COMPONENTS: NAMEDISPLAY ---
      const NameDisplay = ({ currentName, state }) => {
        return (
          <div className="w-full aspect-[16/9] md:aspect-[2/1] bg-[#FFF8E7] rounded-lg border-[12px] md:border-[16px] border-[#EDA545] shadow-2xl flex items-center justify-center relative overflow-hidden ring-4 ring-orange-800/20">
            <div className="absolute inset-2 border-2 border-orange-200 pointer-events-none"></div>
            <div className="relative z-10 w-full text-center px-4">
              <span className={`
                block font-sans font-extrabold text-[#1a1a1a] leading-none
                transition-all duration-100
                ${currentName.length > 3 ? 'text-6xl md:text-8xl' : 'text-7xl md:text-9xl'}
                ${state === AppState.ROLLING ? 'opacity-80 blur-[2px] scale-95' : 'opacity-100 blur-0 scale-100'}
                ${state === AppState.SELECTED ? 'scale-110 drop-shadow-2xl' : ''}
              `}>
                {currentName}
              </span>
            </div>
            <div className="absolute top-0 left-0 w-full h-1/2 bg-gradient-to-b from-white/30 to-transparent pointer-events-none"></div>
          </div>
        );
      };

      // --- 5. COMPONENTS: STUDENTMANAGER ---
      const StudentManager = ({ isOpen, onClose, students, setStudents }) => {
        const fileInputRef = useRef(null);

        if (!isOpen) return null;

        const handleFileUpload = async (e) => {
          if (e.target.files && e.target.files[0]) {
            try {
              const newStudents = await parseExcelFile(e.target.files[0]);
              setStudents(prev => {
                  if (prev.length === 0) return newStudents;
                  return [...prev, ...newStudents];
              });
              if (fileInputRef.current) {
                  fileInputRef.current.value = '';
              }
            } catch (err) {
              alert("Excel Ëß£ÊûêÂ§±Ë¥•ÔºåËØ∑Á°Æ‰øùÊñá‰ª∂Ê†ºÂºèÊ≠£Á°ÆÔºà‰æãÂ¶ÇÔºöÁ¨¨‰∏ÄÂàó‰∏∫ÂßìÂêçÔºâ„ÄÇ");
            }
          }
        };

        const toggleStudent = (id) => {
          setStudents(prev => prev.map(s => s.id === id ? { ...s, active: !s.active } : s));
        };

        const toggleAll = (active) => {
          setStudents(prev => prev.map(s => ({ ...s, active })));
        };

        const clearAll = () => {
          if (students.length === 0) return;
          
          const inactiveCount = students.filter(s => !s.active).length;

          // Logic 1: If unselected exists, prioritize clearing them
          if (inactiveCount > 0) {
             if(window.confirm(`Ê£ÄÊµãÂà∞Êúâ ${inactiveCount} ‰ΩçÊú™ÈÄâ‰∏≠ÁöÑÂ≠¶Áîü„ÄÇ\n\nÊòØÂê¶Âà†Èô§Ëøô‰∫õÊú™ÈÄâ‰∏≠ÁöÑÂ≠¶ÁîüÔºü\nÔºàÁÇπÂáª‚ÄúÁ°ÆÂÆö‚ÄùÂà†Èô§Êú™ÈÄâ‰∏≠È°πÔºåÁÇπÂáª‚ÄúÂèñÊ∂à‚ÄùÂèØÈÄâÊã©Ê∏ÖÁ©∫ÂÖ®ÈÉ®Ôºâ`)) {
                 setStudents(prev => prev.filter(s => s.active));
                 return;
             }
          } 
          
          // Logic 2: Fallback to clear all
          if(window.confirm("Á°ÆÂÆöË¶ÅÊ∏ÖÁ©∫ÊâÄÊúâÂ≠¶ÁîüÂêçÂçïÂêóÔºü\n\nÊ≥®ÊÑèÔºöÊ≠§Êìç‰ΩúÂ∞ÜÂà†Èô§ÊâÄÊúâÊï∞ÊçÆÔºåÊÇ®ÈúÄË¶ÅÈáçÊñ∞ÂØºÂÖ•„ÄÇ")) {
              setStudents([]);
              if (fileInputRef.current) {
                  fileInputRef.current.value = '';
              }
          }
        }

        const activeCount = students.filter(s => s.active).length;

        return (
          <div className="fixed inset-0 z-[100] flex items-center justify-center bg-black/70 backdrop-blur-sm p-4">
            <div className="bg-white rounded-2xl w-full max-w-2xl max-h-[80vh] flex flex-col shadow-2xl overflow-hidden border-4 border-gold-main">
              <div className="bg-china-red p-4 flex justify-between items-center text-white">
                <div className="flex items-center gap-2">
                  <Users className="w-6 h-6 text-gold-main" />
                  <h2 className="text-xl font-bold font-sans">ÁÇπÂêçËåÉÂõ¥ËÆæÁΩÆ</h2>
                </div>
                <button type="button" onClick={onClose} className="hover:bg-red-800 p-2 rounded-full transition-colors">
                  <X className="w-6 h-6" />
                </button>
              </div>

              <div className="p-4 bg-gray-50 border-b flex flex-wrap gap-3 items-center justify-between">
                <div className="flex gap-2">
                   <button 
                      type="button"
                      onClick={() => fileInputRef.current?.click()}
                      className="flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 font-bold shadow-sm transition-transform active:scale-95"
                   >
                      <Upload className="w-4 h-4" /> ÂØºÂÖ• Excel
                   </button>
                   <input 
                      type="file" 
                      ref={fileInputRef} 
                      className="hidden-input" 
                      accept=".xlsx, .xls" 
                      onChange={handleFileUpload}
                   />
                   <button 
                      type="button"
                      onClick={clearAll} 
                      className="flex items-center gap-2 px-3 py-2 text-red-600 hover:bg-red-50 rounded-lg cursor-pointer border border-transparent hover:border-red-200"
                   >
                      <Trash2 className="w-4 h-4" /> Ê∏ÖÁ©∫ÂêçÂçï
                   </button>
                </div>
                <div className="text-sm font-bold text-gray-600">
                  Â∑≤ÈÄâ: <span className="text-china-red text-lg">{activeCount}</span> / {students.length}
                </div>
              </div>

              <div className="px-4 py-2 bg-gray-100 flex gap-4 text-sm border-b">
                  <button type="button" onClick={() => toggleAll(true)} className="text-blue-600 font-bold hover:underline">ÂÖ®ÈÄâ</button>
                  <button type="button" onClick={() => toggleAll(false)} className="text-gray-500 hover:underline">ÂèñÊ∂àÂÖ®ÈÄâ</button>
              </div>

              <div className="flex-1 overflow-y-auto p-4 grid grid-cols-2 sm:grid-cols-3 gap-3 bg-gray-50">
                {students.length === 0 ? (
                  <div className="col-span-full flex flex-col items-center justify-center text-gray-400 py-10">
                      <Upload className="w-12 h-12 mb-2 opacity-50"/>
                      <p>ÊöÇÊó†Â≠¶ÁîüÔºåËØ∑ÂØºÂÖ• Excel Êñá‰ª∂ÔºÅ</p>
                  </div>
                ) : (
                  students.map(student => (
                      <button
                          key={student.id}
                          type="button"
                          onClick={() => toggleStudent(student.id)}
                          className={`
                              flex items-center gap-3 p-3 rounded-lg border-2 transition-all
                              ${student.active 
                                  ? 'bg-white border-china-red shadow-md' 
                                  : 'bg-gray-100 border-transparent opacity-60 grayscale'}
                          `}
                      >
                          {student.active ? (
                              <CheckSquare className="w-5 h-5 text-china-red shrink-0" />
                          ) : (
                              <Square className="w-5 h-5 text-gray-400 shrink-0" />
                          )}
                          <span className={`font-bold truncate ${student.active ? 'text-gray-900' : 'text-gray-500'}`}>
                              {student.name}
                          </span>
                      </button>
                  ))
                )}
              </div>

              <div className="p-4 border-t bg-white flex justify-end">
                  <button 
                      type="button"
                      onClick={onClose}
                      className="px-6 py-2 bg-china-red text-white font-bold rounded-lg shadow-lg hover:bg-red-700 transition-colors"
                  >
                      Á°ÆÂÆö
                  </button>
              </div>
            </div>
          </div>
        );
      };

      // --- 6. MAIN APP COMPONENT ---
      const BGM_URL = "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3"; 

      const DEFAULT_STUDENTS = [
        { id: '1', name: 'ÂàòÈõ®Ê¨£', active: true },
        { id: '2', name: 'ÈôàÊÄùÊòé', active: true },
        { id: '3', name: 'Á´†ÂÆáË¥§', active: true },
        { id: '4', name: 'È©¨Áê¶Áéâ', active: true },
        { id: '5', name: 'ËåÉÊÄùÈáè', active: true },
      ];

      const App = () => {
        const [students, setStudents] = useState(DEFAULT_STUDENTS);
        const [appState, setAppState] = useState(AppState.IDLE);
        const [currentName, setCurrentName] = useState("ÂáÜÂ§á");
        const [isManagerOpen, setIsManagerOpen] = useState(false);
        const [showIntro, setShowIntro] = useState(true);
        
        const timerRef = useRef(null);
        const audioRef = useRef(null);

        useEffect(() => {
          const audio = new Audio(BGM_URL);
          audio.loop = true;
          audio.volume = 0.5;
          audio.preload = 'auto';
          audioRef.current = audio;
          return () => {
              if (audioRef.current) {
                  audioRef.current.pause();
                  audioRef.current = null;
              }
          };
        }, []);

        const activeStudents = students.filter(s => s.active);

        const triggerConfetti = () => {
          const duration = 3 * 1000;
          const end = Date.now() + duration;
          (function frame() {
            confetti({ particleCount: 5, angle: 60, spread: 55, origin: { x: 0 }, colors: ['#FFD700', '#FF0000', '#FFFFFF'] });
            confetti({ particleCount: 5, angle: 120, spread: 55, origin: { x: 1 }, colors: ['#FFD700', '#FF0000', '#FFFFFF'] });
            if (Date.now() < end) requestAnimationFrame(frame);
          }());
        };

        const startAutoDraw = useCallback(() => {
          if (activeStudents.length === 0) {
            alert("Ê≤°ÊúâÂèØÊäΩÂèñÁöÑÂ≠¶ÁîüÔºÅËØ∑ÂÖàÁÇπÂáª‚ÄúËåÉÂõ¥‚ÄùÂØºÂÖ•ÊàñÈÄâÊã©Â≠¶Áîü„ÄÇ");
            setIsManagerOpen(true);
            return;
          }
          setShowIntro(false);
          setAppState(AppState.ROLLING);
          
          if (audioRef.current) {
              audioRef.current.currentTime = 0;
              const playPromise = audioRef.current.play();
              if (playPromise !== undefined) {
                  playPromise.catch(error => console.warn("Audio playback prevented:", error));
              }
          }

          if (timerRef.current) clearInterval(timerRef.current);

          timerRef.current = window.setInterval(() => {
            const randomIndex = Math.floor(Math.random() * activeStudents.length);
            setCurrentName(activeStudents[randomIndex].name);
          }, 50); 
        }, [activeStudents]);

        const stopDraw = useCallback(() => {
          if (timerRef.current) {
              clearInterval(timerRef.current);
              timerRef.current = null;
          }
          if (audioRef.current) audioRef.current.pause();
          
          if (activeStudents.length > 0) {
              const finalIndex = Math.floor(Math.random() * activeStudents.length);
              setCurrentName(activeStudents[finalIndex].name);
          }
          setAppState(AppState.SELECTED);
          triggerConfetti();
        }, [activeStudents]);

        const handleBack = () => {
          if (timerRef.current) clearInterval(timerRef.current);
          if (audioRef.current) {
              audioRef.current.pause();
              audioRef.current.currentTime = 0;
          }
          setAppState(AppState.IDLE);
          setShowIntro(true);
          setCurrentName("ÂáÜÂ§á");
        };

        useEffect(() => {
          return () => {
            if (timerRef.current) clearInterval(timerRef.current);
          };
        }, []);

        return (
          <div className="min-h-screen bg-[#C82E26] relative overflow-hidden flex flex-col font-sans selection:bg-yellow-300 selection:text-red-900">
            {showIntro && (
              <div className="flex-1 w-full h-full flex flex-col md:flex-row animate-in fade-in duration-500">
                <div className="flex-1 flex flex-col justify-center px-8 md:pl-24 z-20 pt-10 md:pt-0">
                   <div className="space-y-4 md:space-y-6 text-left">
                     <h1 className="text-6xl md:text-8xl font-bold text-[#FFFDD0] tracking-wide drop-shadow-md font-festive leading-tight">
                       ÂæíÂÑø‰ª¨Ôºå<br/>‰π¶ËÉå‰∫ÜÂêó
                     </h1>
                     <h2 className="text-3xl md:text-5xl font-bold text-[#FFD700] tracking-wider drop-shadow-sm font-festive">
                       ÊàëË¶ÅÂºÄÂßãÊäΩËÉå‰∫ÜÂì¶
                     </h2>
                   </div>
                   <div className="mt-12 md:mt-20 flex flex-wrap gap-6">
                     <button 
                       onClick={startAutoDraw}
                       className="group relative bg-white text-[#C82E26] text-2xl md:text-3xl font-black py-4 px-10 rounded-full border-b-[6px] border-red-900 shadow-xl active:border-b-0 active:translate-y-2 transition-all hover:bg-gray-50 flex items-center gap-2 font-festive min-w-[200px] justify-center"
                     >
                       <Play className="w-6 h-6 fill-current" />
                       ÂºÄÂßãÊäΩËÉå
                     </button>
                     <button 
                       onClick={() => setIsManagerOpen(true)}
                       className="group relative bg-white text-[#C82E26] text-2xl md:text-3xl font-black py-4 px-10 rounded-full border-b-[6px] border-red-900 shadow-xl active:border-b-0 active:translate-y-2 transition-all hover:bg-gray-50 flex items-center gap-2 font-festive min-w-[160px] justify-center"
                     >
                       <Settings2 className="w-6 h-6" />
                       ËåÉÂõ¥
                     </button>
                   </div>
                </div>
                <div className="flex-1 flex justify-center md:justify-end items-end relative overflow-hidden md:overflow-visible mt-4 md:mt-0">
                   {/* Character lifted up by 10% */}
                   <div className="w-[85%] md:w-[95%] max-w-[800px] relative translate-y-0 md:-translate-y-[10%] md:mr-[-5%] lg:mr-0 pointer-events-none">
                     <TangSeng className="w-full h-auto drop-shadow-2xl" />
                   </div>
                </div>
              </div>
            )}

            {!showIntro && (
              <div className="fixed inset-0 flex flex-col z-10 animate-in fade-in slide-in-from-right duration-500">
                 <div className="absolute top-0 left-0 right-0 p-4 md:p-8 flex justify-between items-start z-50">
                    <h1 className="text-3xl md:text-5xl font-serif font-bold text-[#FFFDD0] drop-shadow-md whitespace-nowrap font-festive mt-2">
                      ‰ªäÂ§©ËÉå‰π¶ÁöÑÊòØ
                    </h1>
                    <div className="flex flex-col gap-4 items-end">
                        <button 
                          onClick={handleBack}
                          className="cursor-pointer bg-white/90 hover:bg-white text-red-700 text-lg md:text-xl font-bold py-2 px-6 rounded-full border-2 border-red-800 shadow-md transition-transform active:scale-95 flex items-center gap-2 pointer-events-auto font-festive"
                        >
                          <ArrowLeft className="w-5 h-5 md:w-6 md:h-6" />
                          ËøîÂõû
                        </button>
                        {appState === AppState.ROLLING && (
                          <button 
                              onClick={stopDraw}
                              className="cursor-pointer bg-[#FFD700] hover:bg-[#FFC200] text-red-900 text-2xl md:text-3xl font-black py-3 px-8 rounded-full border-b-[4px] border-red-900 shadow-xl active:border-b-0 active:translate-y-1 transition-all flex items-center gap-2 pointer-events-auto font-festive animate-bounce-slight"
                          >
                              <Target className="w-6 h-6" />
                              Â∞±ÊòØTA
                          </button>
                        )}
                    </div>
                 </div>
                 <div className="flex-1 flex items-center justify-center w-full h-full relative">
                    <div className="relative w-full max-w-4xl flex flex-col items-center justify-center scale-90 md:scale-100 mt-10">
                        <div className="flex items-end justify-center -mb-24 sm:-mb-32 md:-mb-40 z-0 space-x-[-30px] sm:space-x-[-10px]">
                           <div className="w-32 sm:w-44 md:w-56 transform -rotate-12 translate-y-8 origin-bottom-right">
                              <SunWukong className="w-full h-full drop-shadow-lg" />
                           </div>
                           <div className="w-48 sm:w-64 md:w-80 z-10 -translate-y-6">
                              <TangSeng className="w-full h-full drop-shadow-xl" />
                           </div>
                           <div className="w-32 sm:w-44 md:w-56 transform rotate-12 translate-y-8 origin-bottom-left">
                              <ZhuBajie className="w-full h-full drop-shadow-lg" />
                           </div>
                        </div>
                        <div className="relative z-20 w-[90%] md:w-full max-w-xl px-4">
                           <NameDisplay currentName={currentName} state={appState} />
                        </div>
                        <div className="h-20 mt-6 flex justify-center items-center">
                          {appState === AppState.SELECTED && (
                             <div className="text-[#FFFDD0] text-5xl md:text-6xl font-bold animate-bounce drop-shadow-lg font-festive stroke-black stroke-2">
                                üéâ ÊäΩ‰∏≠Âï¶ÔºÅ üéâ
                             </div>
                          )}
                        </div>
                    </div>
                 </div>
              </div>
            )}

            <StudentManager 
              isOpen={isManagerOpen} 
              onClose={() => setIsManagerOpen(false)}
              students={students}
              setStudents={setStudents}
            />
          </div>
        );
      };

      // --- 7. MOUNT ---
      const root = createRoot(document.getElementById('root'));
      root.render(<App />);
    </script>
  </body>
</html>